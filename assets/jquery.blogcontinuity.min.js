/*
* tumblr template + continuity - script
* v1.9
* 06/07/2017
* music is the sound of math and code is not spaghetti
* complemental.github.io
*/
function getXmlDatakeys(){return["type","media","video","text","ask","quotesource","note","title","date","permalink","via","user","reblog","tags"]}function getTypeMap(){return{photo:"media",video:"media",text:"text",quote:"text",chat:"text",ask:"ask"}}function formatPhoto(a,e){var t='<div class="image-container"><img src="'+a+'"/></div>';return e&&(t='<a href="'+e+'">'+t+"</a>"),t}function formatYouTube(a){return'<div class="video-container"><iframe src="https://www.youtube.com/embed/'+a+'?autoplay=0" frameborder="0" allowfullscreen></iframe></div>'}function formatAsk(a,e,t,i,s){var r,o,n=formatLines(a.reply,"p","ask-reply");return a.user?(r=a.user,a.userlink&&(r='<a href="'+a.userlink+'">'+r+"</a>"),o=a.userpic?a.userpic:i):(r="anonymous",o=s),'<div class="ask-container"> <div class="ask-question-wrapper"> <div class="ask-text"> <p><strong>'+r+'</strong> asked:</p> <div class="ask-question">'+a.question+'</div> </div> <div class="ask-avatar"><img src="'+o+'"/></div></div><div class="ask-reply-wrapper"><div class="ask-avatar-reply" title="'+e+'"><img src="'+t+'"/></div>'+n+"</div></div>"}function formatQuote(a,e,t){return e&&(e='<p class="quote-source">'+e+"</p>"),t||(t=""),'<div class="'+t+'"><q>'+a+"</q>"+e+"</div>"}function formatLines(a,e,t,i){var s="";return $.each(a.split(/\n/),function(a,t){t?(i&&(t=i(t)),s=s+"<"+e+">"+t+"</"+e+">"):s+="<p></p>"}),t||(t=""),'<div class="'+t+'">'+s+"</div>"}function formatChatLine(a){var e=a.split(/:(.+)/);return"<strong>"+e[0]+": </strong>"+e[1].trim()}function formatHashtags(a,e){for(var t=(a=JSON.parse(a)).length,i="",s=0;s<t;s++)i=i+"<span>"+a[s]+"</span>";return'<div class="'+e+'">'+i+"</div>"}function gridLoader(a,e){a.append('<div class="grid-col grid-col--1"></div> <div class="grid-col grid-col--2"></div> <div class="grid-col grid-col--3"></div> <div class="grid-col grid-col--4"></div>'+e),a.colcade({columns:".grid-col",items:".post"})}$.fn.loadContinuity=function(a){function e(e,t){for(var i={},s=getXmlDatakeys(),r=s.length,o=a.postTemplate,n=0;n<r;n++){var l=s[n],c=e.find(l),d=c.text();"ask"===l?d&&(i[l]={},$.each(c.children(),function(a,e){var t=$(this).prop("tagName").toLowerCase();i[l][t]=$(this).text()})):i[l]=d}switch(i.note&&(i.note='<div class="text-content">'+i.note+"</div>"),i.title&&(i.title='<div class="post-title">'+i.title+"</div>"),i.date&&(i.date='title="'+i.date+'"'),i.reblog&&(i.user&&(i.user='<span><a href="http://'+i.user+'.tumblr.com">'+i.user+"</a>:</span>"),i.reblog='<div class="text-reblog">'+i.user+"<p>"+i.reblog+"</p></div>"),i.via&&(i.via='<div class="post-via">(via <a href="'+i.permalink+'">'+i.via+"</a>)</div>"),i.tags&&(i.tags=formatHashtags(i.tags,"tags-wrapper")),i.type){case"text":i.main=formatLines(i.text,"p","text-wrapper");break;case"photo":i.main=formatPhoto(i.media,i.permalink);break;case"quote":i.main=formatQuote(i.text,i.quotesource,"quote-wrapper");break;case"chat":i.main=formatLines(i.text,"p","chat-wrapper",formatChatLine);break;case"video":i.main=formatYouTube(i.video);break;case"ask":i.main=formatAsk(i.ask,a.blogname,a.avatar,a.askDefaultPic,a.askAnonPic);break;default:console.log("error: invalid type.")}for(key in i){var p=new RegExp("{{{"+key+"}}}","g");o=o.replace(p,i[key])}return o}function t(t){var i=$("#"+l+t),s=r+"/"+i.data("page")+".xml";if(i.siblings().hide().removeClass("js-content-open"),i.hasClass("js-content-loaded"))$("html, body").animate({scrollTop:$("#main-wrapper").offset().top-30},600);else{var o="";i.hide(),$.ajax({type:"GET",url:s,dataType:"xml",cache:!1,success:function(t){$(t).find("post").each(function(a){a++,o+=e($(this),a)}),a.loaderCallback?a.loaderCallback(i,o):i.append(o),i.addClass("js-content-loaded")}})}i.fadeIn().addClass("js-content-open")}var i,s=window.location.pathname,r=s.substring(0,s.lastIndexOf("/")),o=window.location.hash.substr(1),n=($("body").width(),$("#wrapper-content")),l="content-page-",c={pages:[],pageNum:1,postTemplate:'<div class="post">{{{main}}}<div class="post-content">{{{via}}}{{{title}}}{{{reblog}}}{{{note}}}{{{tags}}} <ul class="tumblr-links" {{{date}}}> <a href="{{{permalink}}}"><li class="tumblr-permalink"></li></a> <li class="tumblr-reblog"></li> <li class="tumblr-like"></li> </ul> </div> </div>',blogname:null,avatar:"http://i.imgur.com/rElAs3S.png",askDefaultPic:"http://i.imgur.com/rElAs3S.png",askAnonPic:"http://i.imgur.com/S4MHLOw.gif",gridView:!1,loaderCallback:null};(a=$.extend(!0,{},c,a)).pages[0]?(a.blogname||alert("this blog has no name, please name me"),$("#header-avatar").append('<img src="'+a.avatar+'"/>'),jQuery.each(a.pages,function(e,t){var e=e+1;n.append('<div id="'+l+e+'" data-page="'+t+'"></div>'),t==o&&(a.pageNum=e)}),$(".page-nav").bootpag({page:a.pageNum,total:a.pages.length,maxVisible:5,leaps:!0}).on("page",function(a,e){i!==e&&(i=e,n.css("width",n.width()),t(e))}),a.gridView?($("body").addClass("grid-layout"),a.loaderCallback=gridLoader,$.getScript("https://unpkg.com/colcade@0.2.0/colcade.js",function(){t(a.pageNum)})):t(a.pageNum)):n.append("no posts available.")};
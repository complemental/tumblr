/*
* tumblr template + continuity - script
* v1.7
* 06/04/2017
* music is the sound of math and code is not spaghetti
* complemental.github.io
*/
function getXmlDatakeys(){return["type","media","video","text","ask","quotesource","note","title","date","permalink","via","user","reblog","tags"]}function getTypeMap(){return{photo:"media",video:"media",text:"text",quote:"text",chat:"text",ask:"ask"}}function formatPhoto(a,e){return'<a href="'+e+'"><div class="image-container"><img src="'+a+'"/></div></a>'}function formatYouTube(a){return'<div class="video-container"><iframe src="https://www.youtube.com/embed/'+a+'?autoplay=0" frameborder="0" allowfullscreen></iframe></div>'}function formatAsk(a,e,t,s,i){var r,n,o=formatLines(a.reply,"p","ask-reply");return a.user?(r=a.user,a.userlink&&(r='<a href="'+a.userlink+'">'+r+"</a>"),n=a.userpic?a.userpic:s):(r="anonymous",n=i),'<div class="ask-container"> <div class="ask-question-wrapper"> <div class="ask-text"> <p><strong>'+r+'</strong> asked:</p> <div class="ask-question">'+a.question+'</div> </div> <div class="ask-avatar"><img src="'+n+'"/></div></div><div class="ask-reply-wrapper"><div class="ask-avatar-reply" title="'+e+'"><img src="'+t+'"/></div>'+o+"</div></div>"}function formatQuote(a,e,t){return e&&(e='<p class="quote-source">'+e+"</p>"),t||(t=""),'<div class="'+t+'"><q>'+a+"</q>"+e+"</div>"}function formatLines(a,e,t,s){var i="";return $.each(a.split(/\n/),function(a,t){t?(s&&(t=s(t)),i=i+"<"+e+">"+t+"</"+e+">"):i+="<p></p>"}),t||(t=""),'<div class="'+t+'">'+i+"</div>"}function formatChatLine(a){var e=a.split(/:(.+)/);return"<strong>"+e[0]+": </strong>"+e[1].trim()}function formatHashtags(a,e){for(var t=(a=JSON.parse(a)).length,s="",i=0;i<t;i++)s=s+"<span>"+a[i]+"</span>";return'<div class="'+e+'">'+s+"</div>"}$.fn.loadContinuity=function(a){function e(e,t){for(var s={},i=getXmlDatakeys(),r=i.length,n=a.postTemplate,o=0;o<r;o++)"ask"===i[o]?(s[i[o]]={},$.each(e.find(i[o]).children(),function(a,e){var t=$(this).prop("tagName").toLowerCase();s[i[o]][t]=$(this).text()})):s[i[o]]=e.find(i[o]).text();switch(s.note&&(s.note='<div class="text-content">'+s.note+"</div>"),s.title&&(s.title='<div class="post-title">'+s.title+"</div>"),s.date&&(s.date='title="'+s.date+'"'),s.reblog&&(s.user&&(s.user='<span><a href="http://'+s.user+'.tumblr.com">'+s.user+"</a>:</span>"),s.reblog='<div class="text-reblog">'+s.user+"<p>"+s.reblog+"</p></div>"),s.via&&(s.via='<div class="post-via">(via <a href="'+s.permalink+'">'+s.via+"</a>)</div>"),s.tags&&(s.tags=formatHashtags(s.tags,"tags-wrapper")),s.type){case"text":s.main=formatLines(s.text,"p","text-wrapper");break;case"photo":s.main=formatPhoto(s.media,s.permalink);break;case"quote":s.main=formatQuote(s.text,s.quotesource,"quote-wrapper");break;case"chat":s.main=formatLines(s.text,"p","chat-wrapper",formatChatLine);break;case"video":s.main=formatYouTube(s.video);break;case"ask":s.main=formatAsk(s.ask,a.blogname,a.avatar,a.askDefaultPic,a.askAnonPic);break;default:console.log("error: invalid type.")}for(key in s){var l=new RegExp("{{{"+key+"}}}","g");n=n.replace(l,s[key])}return n}function t(t){var s=$("#"+l+t),i=r+"/"+s.data("page")+".xml";if(s.siblings().hide().removeClass("js-content-open"),s.hasClass("js-content-loaded"))$("html, body").animate({scrollTop:$("#main-wrapper").offset().top-30},600);else{var n="";s.hide(),$.ajax({type:"GET",url:i,dataType:"xml",success:function(t){$(t).find("post").each(function(a){a++,n+=e($(this),a)}),a.loaderCallback?a.loaderCallback(s,n):s.append(n),s.addClass("js-content-loaded")}})}s.fadeIn().addClass("js-content-open")}var s,i=window.location.pathname,r=i.substring(0,i.lastIndexOf("/")),n=window.location.hash.substr(1),o=($("body").width(),$("#wrapper-content")),l="content-page-",p={pages:[],pageNum:1,postTemplate:'<div class="post">{{{main}}}<div class="post-content">{{{via}}}{{{title}}}{{{reblog}}}{{{note}}}{{{tags}}} <ul class="tumblr-links" {{{date}}}> <a href="{{{permalink}}}"><li class="tumblr-permalink"></li></a> <li class="tumblr-reblog"></li> <li class="tumblr-like"></li> </ul> </div> </div>',blogname:null,avatar:"http://i.imgur.com/rElAs3S.png",askDefaultPic:"http://i.imgur.com/rElAs3S.png",askAnonPic:"http://i.imgur.com/S4MHLOw.gif",loaderCallback:null};(a=$.extend(!0,{},p,a)).pages[0]?(a.blogname||alert("this blog has no name, please name me"),$("#header-avatar").append('<img src="'+a.avatar+'"/>'),jQuery.each(a.pages,function(e,t){var e=e+1;o.append('<div id="'+l+e+'" data-page="'+t+'"></div>'),t==n&&(a.pageNum=e)}),$(".page-nav").bootpag({page:a.pageNum,total:a.pages.length,maxVisible:5,leaps:!0}).on("page",function(a,e){s!==e&&(s=e,o.css("width",o.width()),t(e))}),t(a.pageNum)):o.append("no posts available.")};
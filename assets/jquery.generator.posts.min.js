/*
* tumblr template + continuity - posts generator script
* v1.8
* 06/14/2017
* music is the sound of math and code is not spaghetti
* complemental.github.io
*/
$(document).ready(function(){function e(e){if(void 0!=e||""!=e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,i=e.match(t);if(i&&11==i[2].length)return i[2]}}function t(e){return/(jpg|jpeg|gif|png)$/i.test(e)?1:null}function i(e){return{user:e.find(".input-askuser:first").val(),userlink:e.find(".input-askuserlink:first").val(),userpic:e.find(".input-askuserpic:first").val(),question:e.find(".input-ask:first").val(),reply:e.find(".input-askreply:first").val()}}function n(n){var r=n.attr("data-type"),a=n.find(".input-"+u[r]+":first").val();if("photo"===r){if(t(a))return'<img src="'+a+'"/>'}else if("video"===r){var s;if(s=e(a))return'<iframe src="https://www.youtube.com/embed/'+s+'?autoplay=0" frameborder="0"></iframe>'}else{if("quote"===r)return formatQuote(a,n.find(".input-quotesource:first").val(),"quote-wrapper");if("text"===r)return formatLines(a,"p","text-wrapper");if("chat"===r)return formatLines(a,"p","chat-wrapper",formatChatLine);if("ask"===r){var o=i(n);return formatAsk(o,"yourblogname","http://i.imgur.com/rElAs3S.png","http://i.imgur.com/rElAs3S.png","http://i.imgur.com/S4MHLOw.gif")}}return"yikes something went wrong, please check that your media url is valid!"}function r(n){var r="",a={},s=["note","reblog","text","quotesource"];if($.each(o,function(e,t){"type"===t?a[t]=n.attr("data-type"):"ask"===t?n.find(".input-"+t+":first").val()&&(a[t]=i(n)):"via"!==t&&"video"!==t&&(a[t]=n.find(".input-"+t+":first").val())}),"photo"===a.type){if(!t(a.media))return null}else if("video"===a.type){var u;if(!(u=e(a.media)))return null;a.video=u}return a.permalink&&(a.via=a.permalink.split("/")[2].split(".")[0]),$.each(a,function(e,t){if(t){if("tags"===e)t=t.split(",").map(function(e){return e.replace("#","").trim()}),t=JSON.stringify(t);else if("ask"===e){var i="";$.each(t,function(e,t){t&&(t="<![CDATA["+t+"]]>"),i=i+"\n\t\t<"+e+">"+t+"</"+e+">"}),t=i+"\n\t"}$.inArray(e,s)>-1&&(t="<![CDATA["+t+"]]>"),r=r+"\n\t<"+e+">"+t+"</"+e+">"}}),"\n<post>"+r+"\n</post>"}var a=$("#content"),s=$("#generate"),o=($("#generated-panel"),getXmlDatakeys()),u=getTypeMap();jQuery(".repeat").each(function(){jQuery(this).repeatable_fields({wrapper:".wrapper",container:".container",after_add:function(){s.hasClass("js-gen-active")||(s.addClass("js-gen-active"),s.fadeIn())},after_remove:function(){$(".row")[1]||(s.removeClass("js-gen-active"),s.fadeOut())}})}),a.fadeIn(),a.on("click",".view-mode",function(){var e=$(this).parent(),t=e.siblings(".input-container"),i=e.siblings(".preview"),r="";$(this).hasClass("js-is-preview")?$(this).removeClass("js-is-preview"):($(this).addClass("js-is-preview"),r=n(t)),t.slideToggle(200,function(){i.slideToggle(300,function(){i.html(r)})})}),a.on("click","#generate",function(){var e="";$(".row:not(.template)").each(function(){e+=r($(this).children(".input-container:first"))});var t=new Blob(['<?xml version="1.0" encoding="UTF-8"?> \n<blog>'+e+"\n</blog>"],{type:"text/plain;charset=utf-8"});saveAs(t,"yourfilename.xml")}),a.on("click",".type-selection li",function(){var e=$(this).closest(".type-selection"),t=e.siblings(".input-container"),i=$(this).attr("class").substr(7),n=t.children(".type-option");t.attr("data-type",i),n.each(function(){$(this).hasClass("type-"+i)||$(this).hide()}),e.fadeOut(200),t.fadeIn()})});
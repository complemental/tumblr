/*
* tumblr template + continuity - posts generator script
* v1.7
* 06/04/2017
* music is the sound of math and code is not spaghetti
* complemental.github.io
*/
$(document).ready(function(){function t(t){if(void 0!=t||""!=t){var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,i=t.match(e);if(i&&11==i[2].length)return i[2]}}function e(t){return/(jpg|jpeg|gif|png)$/i.test(t)?1:null}function i(t){return{user:t.find(".input-askuser:first").val(),userlink:t.find(".input-askuserlink:first").val(),userpic:t.find(".input-askuserpic:first").val(),question:t.find(".input-ask:first").val(),reply:t.find(".input-askreply:first").val()}}function n(n){var r=n.attr("data-type"),a=n.find(".input-"+l[r]+":first").val();if("photo"===r){if(e(a))return'<img src="'+a+'"/>'}else if("video"===r){var s;if(s=t(a))return'<iframe src="https://www.youtube.com/embed/'+s+'?autoplay=0" frameborder="0"></iframe>'}else{if("quote"===r)return formatQuote(a,n.find(".input-quotesource:first").val(),"quote-wrapper");if("text"===r)return formatLines(a,"p","text-wrapper");if("chat"===r)return formatLines(a,"p","chat-wrapper",formatChatLine);if("ask"===r){var o=i(n);return formatAsk(o,"yourblogname","http://i.imgur.com/rElAs3S.png","http://i.imgur.com/rElAs3S.png","http://i.imgur.com/S4MHLOw.gif")}}return"yikes something went wrong, please check that your media url is valid!"}function r(n){var r="",a={},s=["note","reblog","text","quotesource"];if($.each(u,function(t,e){"type"===e?a[e]=n.attr("data-type"):"ask"===e?n.find(".input-"+e+":first").val()&&(a[e]=i(n)):"via"!==e&&"video"!==e&&(a[e]=n.find(".input-"+e+":first").val())}),"photo"===a.type){if(!e(a.media))return null}else if("video"===a.type){var o;if(!(o=t(a.media)))return null;a.video=o}return a.permalink&&(a.via=a.permalink.split("/")[2].split(".")[0]),$.each(a,function(t,e){if(e){if("tags"===t)e=e.split(",").map(function(t){return t.replace("#","").trim()}),e=JSON.stringify(e);else if("ask"===t){var i="";$.each(e,function(t,e){e&&(e="<![CDATA["+e+"]]>"),i=i+"\n\t\t<"+t+">"+e+"</"+t+">"}),e=i+"\n\t"}$.inArray(t,s)>-1&&(e="<![CDATA["+e+"]]>"),r=r+"\n\t<"+t+">"+e+"</"+t+">"}}),"\n<post>"+r+"\n</post>"}var a=$("#content"),s=$("#generate"),o=$("#generated-panel"),u=getXmlDatakeys(),l=getTypeMap();jQuery(".repeat").each(function(){jQuery(this).repeatable_fields({wrapper:".wrapper",container:".container",after_add:function(){s.hasClass("js-gen-active")||(s.addClass("js-gen-active"),s.fadeIn())},after_remove:function(){$(".row")[1]||(s.removeClass("js-gen-active"),s.fadeOut())}})}),a.fadeIn(),a.on("click",".view-mode",function(){var t=$(this).parent(),e=t.siblings(".input-container"),i=t.siblings(".preview"),r="";$(this).hasClass("js-is-preview")?$(this).removeClass("js-is-preview"):($(this).addClass("js-is-preview"),r=n(e)),e.slideToggle(200,function(){i.slideToggle(300,function(){i.html(r)})})}),a.on("click","#generate",function(){var t="";$(".row:not(.template)").each(function(){t+=r($(this).children(".input-container:first"))}),o.slideDown(300,function(){o.children("textarea:first").val('<?xml version="1.0" encoding="UTF-8"?> \n<blog>'+t+"\n</blog>").select(),$("html, body").animate({scrollTop:$(document).height()},300)})}),a.on("click",".type-selection li",function(){var t=$(this).closest(".type-selection"),e=t.siblings(".input-container"),i=$(this).attr("class").substr(7),n=e.children(".type-option");e.attr("data-type",i),n.each(function(){$(this).hasClass("type-"+i)||$(this).hide()}),t.fadeOut(200),e.fadeIn()})});
